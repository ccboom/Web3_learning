# 公钥密码学入门：RSA 与 ECC (椭圆曲线) 的区别

---

## 第一部分：陷门函数 (Trapdoor Function)

### 什么是陷门函数？

简单来说就是：**计算的时候很简单，但是逆向计算非常复杂**。如果没有特殊信息基本不可能完成的函数运算，这就是陷门函数的思想设计。

### 陷门函数与 RSA/ECC 的关系

- **陷门函数** = 灵魂（设计思想）
- **RSA/ECC** = 肉体（实现方式）

既然我们现在知道了两个的关系，那么我们来分别看看 RSA 和 ECC 各自是什么样子的。

---

## 第二部分：RSA 与 ECC 的核心原理

### RSA：大整数分解

RSA 的核心其实是**大整数的分解**。我们可以把它想象成为**颜料混合**：

1. **混合颜料**：现在有两种颜色的颜料（两个大的质数，作为私钥的一部分），我们把这俩颜料倒入桶内，搅一搅就得到一个新的颜色（就是公钥）

2. **逆向困难**：那现在我们有了搅拌后的颜料，现在告诉你说，这是哪两个颜色形成的？这基本上不可能推算出来吧

3. **私钥优势**：但是，如果手里有一种原本的颜色（私钥），那么利用化学或者物理方法，就可以比较容易的推算出另一个颜色

**总结**：RSA 靠的是**破坏性结构导致的不可逆性**（把两个大数融合为一个）

### ECC：椭圆曲线离散对数

ECC 的核心是**椭圆曲线离散对数问题**。我们可以把它想象为**在一个奇怪的台球桌子上打桌球**：

1. **正向计算**：我们从 G 点开始击球，球遵循一种特殊的规则在弹来弹去（椭圆曲线方程），假设弹了 k 次（k 为私钥），那么就能很容易的知道最终的落点是哪个（P 点，也就是公钥）
   ```
   打一次 ： 球在 A 点
   打两次 ： 球在 B 点
   ...
   打 k 次 ： 球在 P 点
   ```

2. **逆向困难**：现在告诉你球的起点 G 和球的终点 P，那问题是：我刚刚到底打了多少次？k 是多少？
   
   在这个台球桌上，球的轨迹非常之混乱并且毫无规律，想要简单的从 P 点开始往回倒退是不现实的，只能笨拙的从 1 开始一次次尝试，直到试出来 P 点为止

3. **陷门**：这里的陷门就是次数 K，就算知道了起点和终点，对于比尔来说也无法知道中间经历了多少次反弹

**总结**：正向计算非常快，但逆向推导却非常困难，只能像无头苍蝇一样去试。这在数学上称之为 **离散对数问题 (Discrete Logarithm Problem, DLP)**

---

## 第三部分：数学公式

### RSA：大整数分解

RSA 依赖我们小学学过的乘法，但是数字非常之大。

**制造一个锁**：取两个超大的质数 P 和 q（私钥），把他们乘起来得到 N（公钥的一部分）

$$N = p \times q$$

**陷门**：全世界都知道 N，但是没人能轻易的把它拆分为 p 和 q

### ECC：椭圆曲线离散对数

ECC 依赖我们在台球桌上的点价运算。

**制造一个锁**：选一个基点 G，和一个整数 k（私钥）。在这个曲线上做 K 次标量乘法，得到终点 P（公钥）

$$P = k \cdot G$$

> 注意：这里的 $\cdot$ 代表椭圆曲线上的标量乘法，不是普通的乘法

**陷门**：全世界都知道 G 和 P，但没人能算出 k 是多少

---

## 第四部分：两个的关键区别

### 抗破解强度的差异

虽然两个看起来都是两个数的某种积，但是抗破解强度完全不同。

我们假设 RSA 的 N 是 77，你会迅速算出是 7×11 的积，但现在 RSA 标准通常要求 N 至少有 2048 位。

**问**：根据你对计算机的理解，你认为数字足够大，黑客就束手无策了吗？还是说攻击成本太高，破解失去了意义？

**答**：答案显然是后者。我们赌的是攻击者不喜欢花设备、时间和电费去破解，价值太低。

### 数学性质上最大的区别

#### RSA 的弱点

数学家太聪明了，他们已经找到了一些算法捷径，比如著名的 **"通用数域筛法" (GNFS)**。这不是说能秒破解，但是也比从 1 开始一个一个试快的多。

**比喻**：就像在草坪上面找盐，虽然不好找，但是攻击者发明了一种过滤器，可以过滤掉一大半的草，找起来更容易了。

#### ECC 的优势

目前针对椭圆曲线离散对数，数学界还没有高效的捷径。攻击者面对 ECC 只能老实的一个一个试。

**比喻**：在草坪上没有过滤器，只能一根接一根的找。

### 工程应用的巨大差异

这导致了他们在工程上应用的巨大差异。

我们在使用 RSA 的时候会考虑到有过滤器的情况，而使用 ECC 则不需要。那么为了达到相同的安全等级，**RSA 的位数要比 ECC 的位数长的多**：

| 安全强度 | RSA 密钥长度 | ECC 密钥长度 |
|---------|------------|------------|
| 80 (不再安全) | 1024-bit | 160-bit |
| 112 (基本安全) | 2048-bit | 224-bit |
| 128 (主流标准) | 3072-bit | 256-bit |
| 256 (军用级) | 15360-bit | 512-bit |

现在 BTC 和 ETH 使用的 secp256K1 曲线就是 256 位的 ECC 私钥。如果想要使用 RSA 达到相同级别，那么你需要一把 **3072 位的钥匙**！

---

## 第五部分：为什么区块链使用 ECC？

### 1. 存储空间

- **RSA**：3072 位，大约 384 字节
- **ECC**：256 位，大约 32 字节

**十倍的差距**！在区块链这种每个字节都永久存储需要支付费用的系统中，如果使用 RSA 手续费可能会增加 10 倍以上，这是毁灭性打击。

### 2. 速度

数据越小，网络传输（就是同步块数据）也就越快，不容易造成拥堵。在运算速度上 ECC 的签名和密钥生成速度也远快于 RSA，这对用户体验也有很大增进。

---

## 学习总结

今天我们学习了三个模块：

✅ **物理直觉**：混合颜料 vs. 疯狂台球

✅ **数学原理**：大数分解 vs. 离散对数

✅ **工程效率**：为什么区块链非 ECC 不可

---

明天再见。
